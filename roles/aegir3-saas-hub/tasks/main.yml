---
  - name: Check if custom hostmaster modules are installed
    shell: "[ -d `/var/aegir/hostmaster-*/sites/{{ inventory_hostname }}/modules/hosting_network`]"
    register: aegir_custom_modules_exist
    failed_when: '"found" in aegir_custom_modules_exist.stderr'
    ignore_errors: yes

  - name: Download the SaaS modules from drupal.org
    shell: drush @hostmaster dl hosting_network
    when: aegir_custom_modules_exist|failed
    sudo: yes
    sudo_user: aegir
  # TODO: Download features, enable modules

  - name: Write hosting server import file
    template: src=hosting_network_nodes.json.j2 dest=/tmp/hosting_network_nodes.json owner=aegir group=www-data
